import{r as u,u as J,A as C,R as O,j as e,D as X,T as $,B as b,I as K,C as Y,F as Z,a as _,b as q,G as j,P as w,e as d,M as Q,g as U,p as H,l as T,S as ee}from"./index-10d1eba3.js";import{u as te,c as oe,M as ne,N as ie,G as ae,a as se,b as I}from"./styles-8ece2793.js";import{R as le}from"./Restore-44624c40.js";const re={width:500,height:400,latitude:0,longitude:0,zoom:3},pe=A=>{const{open:B,onClose:f,onCreate:D}=A,L=!0,R=te(),W="lg",y=u.useRef(),{userToken:m}=J(),[o,p]=u.useState({longitude:0,latitude:0,zoom:2}),[h,z]=u.useState([]),[S,x]=u.useState(""),[E,F]=u.useState([]),k=()=>{f(!1),x(""),p({longitude:0,latitude:0,zoom:2})};u.useEffect(()=>{var i;o&&((i=y.current)==null||i.flyTo({center:[o.longitude,o.latitude],duration:2e3,zoom:14}))},[o]),u.useEffect(()=>{m&&C.listVoiture(m).then(i=>i.json()).then(i=>z(i)).catch(i=>console.log(i))},[m]),u.useEffect(()=>{if(o&&o.latitude!==0&&o.longitude!==0){const{longitude:i,latitude:s}=o;(async()=>{try{const n=await I.get(`https://api.geoapify.com/v1/geocode/reverse?lat=${s}&lon=${i}&apiKey=aedf3186d09b474abd1a8808eaf0bcc1`),{formatted:a}=n.data.features[0].properties;x(a)}catch(n){console.error(n)}})().catch(n=>console.log(n))}},[o]),u.useEffect(()=>{(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{const{latitude:l,longitude:n}=s.coords;p({...o,latitude:l,longitude:n})},s=>{console.log(s.message)}):console.log("Geolocation is not supported by your browser.")})()},[o]);const G=async i=>{const s=i.target.value;x(s);try{if(s.length>=3){const n=(await I.get(`https://api.geoapify.com/v1/geocode/autocomplete?text=${s}&limit=5&apiKey=aedf3186d09b474abd1a8808eaf0bcc1`)).data.features.map(a=>({label:a.properties.formatted,latitude:a.properties.lat,longitude:a.properties.lon}));F(n)}}catch(l){console.error(l)}},M=O.useCallback(i=>{i&&i.trigger()},[]);return e.jsxs(X,{fullScreen:!0,open:B,onClose:k,TransitionComponent:$,fullWidth:L,maxWidth:W,className:R.dialog,children:[e.jsx(b,{sx:{m:2},children:e.jsx(K,{onClick:()=>f(!1),sx:{borderRadius:2},children:e.jsx(Y,{})})}),e.jsx(Z,{initialValues:{titre:"",description:"",prix:0,voiture:0,latitude:0,longitude:0,address:""},validationSchema:oe,onSubmit:console.log,children:({values:i,handleChange:s,handleBlur:l,errors:n,touched:a,isValid:N,handleReset:P})=>e.jsxs(_,{method:"post",onSubmit:t=>{t.preventDefault();const r=new FormData(t.currentTarget),g={};for(const[c,v]of r.entries())c==="prix"?g[c]=parseInt(v.toString()):g[c]=v;g.latitude=o.latitude,g.longitude=o.longitude;const V=JSON.stringify(g);C.createAnnonce(V,m).then(c=>c.json()).then(c=>{console.log(c),D(c),P(t)}).catch(c=>{console.log(c.message),console.log(c)}).finally(()=>f(!1))},children:[e.jsx(q,{variant:"h2",textAlign:"center",sx:{fontSize:"3rem"},children:"Cree une annonce"}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:5,flexDirection:"row",width:"100%",mt:5},container:!0,p:3,children:[e.jsxs(j,{md:5,sm:12,xs:12,item:!0,sx:{display:"flex",gap:1,flexDirection:"column",alignItems:"flex-start"},component:w,p:1,children:[e.jsx(d,{label:"Titre",name:"titre",value:i.titre,onChange:s("titre"),onBlur:l("titre"),error:!!(a.titre&&n.titre),helperText:a.titre&&n.titre.toString(),fullWidth:!0}),e.jsx(d,{label:"Voiture",name:"voiture",value:i.voiture,onChange:s("voiture"),onBlur:l("voiture"),error:!!(a.voiture&&n.voiture),helperText:a.voiture&&n.voiture.toString(),fullWidth:!0,select:!0,children:h==null?void 0:h.map(t=>{var r;return e.jsxs(Q,{value:t.id,children:[(r=t.model.marque)==null?void 0:r.nom," ",t.model.nom," ",t.type_carburant," ",t.annee]},t.id)})}),e.jsx(d,{label:"Prix",InputProps:{startAdornment:e.jsx(U,{position:"start",children:"XAF"})},name:"prix",type:"number",value:i.prix,onChange:s("prix"),onBlur:l("prix"),error:!!(a.prix&&n.prix),helperText:a.prix&&n.prix.toString(),fullWidth:!0}),e.jsx(d,{label:"Description",multiline:!0,rows:4,name:"description",value:i.description,onChange:s("description"),onBlur:l("description"),error:!!(a.description&&n.description),helperText:a.description&&n.description.toString(),fullWidth:!0}),e.jsx(H,{freeSolo:!0,options:E,getOptionLabel:t=>t.label,inputValue:S,onInputChange:t=>{G(t).catch(r=>console.log(r))},onChange:(t,r)=>{x(r?r.label:""),p({...o,longitude:r.longitude,latitude:r.latitude})},fullWidth:!0,renderInput:t=>e.jsx(d,{...t,name:"address",label:"Address",variant:"outlined"})}),e.jsxs(b,{style:{width:"100%",display:"flex",gap:5},children:[e.jsx(d,{label:"Latitude",name:"latitude",value:o.latitude,disabled:!0,fullWidth:!0,onChange:s("latitude"),onBlur:l("latitude"),error:!!(a.latitude&&n.latitude),helperText:!!a.latitude&&n.latitude.toString()}),e.jsx(d,{label:"Longitude",name:"longitude",value:o.longitude,disabled:!0,fullWidth:!0,onChange:s("longitude"),onBlur:l("longitude"),error:!!(a.longitude&&n.longitude),helperText:a.longitude&&n.longitude.toString()})]}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[e.jsx(T,{startIcon:e.jsx(le,{}),size:"large",color:"error",variant:"contained",type:"reset",children:"Reset"}),e.jsx(T,{startIcon:e.jsx(ee,{}),size:"large",color:"success",variant:"contained",type:"submit",disabled:!N&&S===""||o.latitude===0||o.longitude===0,children:"Save"})]})]}),e.jsx(j,{md:5,sm:12,xs:12,item:!0,component:w,children:e.jsxs(ne,{ref:y,initialViewState:re,style:{width:"100%",height:500},mapStyle:"mapbox://styles/mapbox/streets-v9",mapboxAccessToken:"pk.eyJ1IjoiaXZhbnRvbSIsImEiOiJjbDJnMGlwNnYwZm9zM2duYnQ0a3c2bXFvIn0.x29uaFl79xgLW6nCs15JWw",children:[e.jsx(ie,{}),e.jsx(ae,{showAccuracyCircle:!0,showUserLocation:!0,ref:M,onGeolocate:t=>p({...o,longitude:t.coords.longitude,latitude:t.coords.latitude})}),e.jsx(se,{onDragEnd:t=>p({...o,latitude:t.lngLat.lat,longitude:t.lngLat.lng}),draggable:!0,longitude:o.longitude,latitude:o.latitude,anchor:"bottom"})]})})]})]})})]})};export{pe as default};
